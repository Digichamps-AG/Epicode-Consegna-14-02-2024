let
    Origine = Excel.Workbook(File.Contents("C:\Users\Giada\Desktop\Inutilepicode\Settimana 9\S9L2\M3S1E2.xlsx"), null, true),
    #"Passaggio rinominato 1" = Origine{[Item="Ordini",Kind="Sheet"]}[Data],
    #"Intestazioni alzate di livello" = Table.PromoteHeaders(#"Passaggio rinominato 1", [PromoteAllScalars=true]),
    #"Modificato tipo" = Table.TransformColumnTypes(#"Intestazioni alzate di livello",{{"dqwdqw", type text}, {"Column2", type any}, {"Column3", type any}, {"Column4", type text}, {"Column5", type text}, {"Column6", type any}, {"Column7", type text}, {"Column8", type text}, {"Column9", type any}, {"Column10", type any}, {"Column11", type any}}),
    #"Rimosse prime righe" = Table.Skip(#"Modificato tipo",2),
    #"Intestazioni alzate di livello1" = Table.PromoteHeaders(#"Rimosse prime righe", [PromoteAllScalars=true]),
    #"Passaggio rinominato" = Table.TransformColumnTypes(#"Intestazioni alzate di livello1",{{"COD PROD", type text}, {"Column2", type any}, {"Column3", type any}, {"Collaboratore", type text}, {"Regione", type text}, {"Column6", type date}, {"Categoria", type text}, {"Prodotto", type text}, {"Column9", type any}, {"Prezzo unitario", type number}, {"Quantità", Int64.Type}}),
    #"Rimosse colonne" = Table.RemoveColumns(#"Passaggio rinominato",{"Column2", "Column3", "Column9"}),
    #"Filtrate righe" = Table.SelectRows(#"Rimosse colonne", each true),
    #"Sostituito valore" = Table.ReplaceValue(#"Filtrate righe",null,0,Replacer.ReplaceValue,{"Quantità"}),
    #"Rinominate colonne" = Table.RenameColumns(#"Sostituito valore",{{"Column6", "Data Ordine"}}),
    #"Convertita in maiuscolo ogni parola" = Table.TransformColumns(#"Rinominate colonne",{{"Collaboratore", Text.Proper, type text}, {"Regione", Text.Proper, type text}, {"Categoria", Text.Proper, type text}, {"Prodotto", Text.Proper, type text}}),
    #"Testo troncato" = Table.TransformColumns(#"Convertita in maiuscolo ogni parola",{{"Collaboratore", Text.Trim, type text}, {"Regione", Text.Trim, type text}, {"Categoria", Text.Trim, type text}, {"Prodotto", Text.Trim, type text}}),
    #"Passaggio rinominato 2" = Table.TransformColumns(#"Testo troncato",{{"Collaboratore", Text.Clean, type text}, {"Regione", Text.Clean, type text}, {"Categoria", Text.Clean, type text}, {"Prodotto", Text.Clean, type text}}),
    #"Aggiunta colonna personalizzata" = Table.AddColumn(#"Passaggio rinominato 2", "CATPROD", each [Categoria] & " " & [Prodotto]),
    #"Colonna condizionale aggiunta" = Table.AddColumn(#"Aggiunta colonna personalizzata", "Colonna Condizionale", each if [Quantità] > 20 then "TROVATO" else if [Quantità] <= 20 then "NA" else null),
    #"Filtrate righe1" = Table.SelectRows(#"Colonna condizionale aggiunta", each true),
    #"Testo in maiuscolo" = Table.TransformColumns(#"Filtrate righe1",{{"Regione", Text.Upper, type text}}),
    #"Ordinate righe" = Table.Sort(#"Testo in maiuscolo",{{"Collaboratore", Order.Ascending}}),
    #"Aggiunta colonna personalizzata1" = Table.AddColumn(#"Ordinate righe", "Cifre COD PROD", each [COD PROD]),
    #"Dividi colonna per passaggio carattere" = Table.SplitColumn(#"Aggiunta colonna personalizzata1", "Cifre COD PROD", Splitter.SplitTextByCharacterTransition((c) => not List.Contains({"0".."9"}, c), {"0".."9"}), {"Cifre COD PROD.1", "Cifre COD PROD.2"}),
    #"Filtrate righe2" = Table.SelectRows(#"Dividi colonna per passaggio carattere", each ([Collaboratore] <> "Fove Anna")),
    #"Rinominate colonne1" = Table.RenameColumns(#"Filtrate righe2",{{"Cifre COD PROD.1", "Lettere COD PROD.1"}}),
    #"Aggiunta colonna personalizzata2" = Table.AddColumn(#"Rinominate colonne1", "Totale", each [Quantità]*[Prezzo unitario]),
    #"Riordinate colonne" = Table.ReorderColumns(#"Aggiunta colonna personalizzata2",{"COD PROD", "Collaboratore", "Regione", "Data Ordine", "Categoria", "Prodotto", "Prezzo unitario", "Quantità", "Totale", "CATPROD", "Colonna Condizionale", "Lettere COD PROD.1", "Cifre COD PROD.2"}),
    #"Aggiunta colonna personalizzata3" = Table.AddColumn(#"Riordinate colonne", "IVA", each [Totale]*22/100),
    #"Riordinate colonne1" = Table.ReorderColumns(#"Aggiunta colonna personalizzata3",{"COD PROD", "Collaboratore", "Regione", "Data Ordine", "Categoria", "Prodotto", "Prezzo unitario", "Quantità", "Totale", "IVA", "CATPROD", "Colonna Condizionale", "Lettere COD PROD.1", "Cifre COD PROD.2"}),
    #"Colonna condizionale aggiunta1" = Table.AddColumn(#"Riordinate colonne1", "Data condizionale", each if Date.Month([Data Ordine]) >= 5 then "DOPO" else "PRIMA"),
    #"Sostituito valore1" = Table.ReplaceValue(#"Colonna condizionale aggiunta1","Pium","Piuma",Replacer.ReplaceText,{"Prodotto"}),
    #"Testo in maiuscolo1" = Table.TransformColumns(#"Sostituito valore1",{{"Collaboratore", Text.Upper, type text}})
in
    #"Testo in maiuscolo1"